<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - Fixed Input</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-animation {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .file-upload:hover {
            transform: scale(1.1);
            transition: all 0.2s ease;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 5px;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen">
    <div class="container mx-auto h-full flex flex-col max-w-4xl">
        <!-- Header -->
        <header class="gradient-bg text-white p-4 rounded-b-lg shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-purple-600 text-xl"></i>
                    </div>
                    <h1 class="text-xl font-bold">AI Chat Assistant</h1>
                </div>
                <div class="text-sm">
                    <span class="bg-white text-purple-600 px-2 py-1 rounded-full">Online</span>
                </div>
            </div>
        </header>
        
        <!-- Chat Container -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatContainer">
            <!-- AI Welcome Message -->
            <div class="flex space-x-3 message-animation">
                <div class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs sm:max-w-md md:max-w-lg">
                    <p class="text-gray-800">Halo! Saya AI Assistant. Sekarang kolom input sudah diperbaiki dan bisa digunakan:</p>
                    <ol class="list-decimal pl-5 mt-2 text-gray-700 text-sm">
                        <li>Ketik pesan di kolom bawah</li>
                        <li>Tekan tombol kirim atau Enter</li>
                        <li>Pesan akan muncul di chat</li>
                    </ol>
                    <p class="text-xs text-gray-500 mt-2" id="currentTime"></p>
                </div>
            </div>
        </div>
        
        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-200 rounded-t-lg shadow-lg">
            <!-- File Preview Section -->
            <div id="filePreviewContainer" class="hidden mb-2">
                <div class="flex items-center justify-between bg-gray-100 p-2 rounded-lg">
                    <div id="filePreviewContent"></div>
                    <button id="clearFiles" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex items-center space-x-2">
                <!-- File Upload -->
                <label for="fileUpload" class="file-upload cursor-pointer w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center">
                    <i class="fas fa-paperclip text-gray-500"></i>
                    <input id="fileUpload" type="file" accept="image/*,video/*" class="hidden" multiple>
                </label>
                
                <!-- Message Input -->
                <div class="flex-1 relative">
                    <input type="text" id="messageInput" placeholder="Ketik pesan Anda..." 
                        class="w-full p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button id="sendButton" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-purple-500 hover:bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current time
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
            
            // Chat functionality
            const chatContainer = document.getElementById('chatContainer');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const fileUpload = document.getElementById('fileUpload');
            const filePreviewContainer = document.getElementById('filePreviewContainer');
            const filePreviewContent = document.getElementById('filePreviewContent');
            const clearFiles = document.getElementById('clearFiles');
            let filesToUpload = [];
            
            // Send message function (FIXED)
            function sendMessage() {
                const message = messageInput.value.trim();
                const hasFiles = filesToUpload.length > 0;
                
                if (message || hasFiles) {
                    // Add user message to chat
                    if (message) {
                        addMessageToChat(message, 'user');
                    }
                    
                    // Add files to chat if any
                    if (hasFiles) {
                        filesToUpload.forEach(file => {
                            if (file.type.startsWith('image/')) {
                                addFileMessageToChat(file, 'image', 'user');
                            } else if (file.type.startsWith('video/')) {
                                addFileMessageToChat(file, 'video', 'user');
                            }
                        });
                    }
                    
                    // Clear input and files
                    messageInput.value = '';
                    filesToUpload = [];
                    filePreviewContainer.classList.add('hidden');
                    filePreviewContent.innerHTML = '';
                    
                    // Simulate AI response after 1 second
                    setTimeout(() => {
                        generateAIResponse(message);
                    }, 1000);
                }
            }
            
            // Generate AI response based on user input
            function generateAIResponse(userMessage) {
                let response = "";
                
                if (userMessage.toLowerCase().includes('halo') || userMessage.toLowerCase().includes('hi')) {
                    response = "Halo! Bagaimana saya bisa membantu Anda hari ini?";
                } else if (userMessage.toLowerCase().includes('cuaca')) {
                    response = "Cuaca hari ini cukup cerah dengan suhu sekitar 28Â°C. Apakah Anda ingin tahu lebih banyak tentang ramalan cuaca?";
                } else if (userMessage.toLowerCase().includes('berita')) {
                    response = "Berita terbaru: Pasar saham mengalami kenaikan signifikan hari ini. Apakah Anda ingin tahu lebih banyak?";
                } else if (userMessage.toLowerCase().includes('teknologi')) {
                    response = "Teknologi terus berkembang dengan pesat. Saat ini, AI dan machine learning menjadi fokus utama banyak perusahaan.";
                } else {
                    response = "Saya tidak sepenuhnya memahami pertanyaan Anda. Namun, saya di sini untuk membantu! Coba tanyakan hal lain.";
                }
                
                addMessageToChat(response, 'ai');
            }
            
            // Add message to chat
            function addMessageToChat(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex space-x-3 message-animation ${sender === 'user' ? 'justify-end' : ''}`;
                
                if (sender === 'user') {
                    messageDiv.innerHTML = `
                        <div class="bg-purple-500 text-white p-3 rounded-lg shadow-sm max-w-xs sm:max-w-md md:max-w-lg">
                            <p>${message}</p>
                            <p class="text-xs text-purple-100 mt-2 text-right">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white"></i>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs sm:max-w-md md:max-w-lg">
                            <p class="text-gray-800">${message}</p>
                            <p class="text-xs text-gray-500 mt-2">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                    `;
                }
                
                chatContainer.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // Add file message to chat
            function addFileMessageToChat(file, type, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex space-x-3 message-animation ${sender === 'user' ? 'justify-end' : ''}`;
                
                const fileUrl = URL.createObjectURL(file);
                let content = '';
                
                if (type === 'image') {
                    content = `<img src="${fileUrl}" alt="Uploaded image" class="image-preview">`;
                } else if (type === 'video') {
                    content = `<video controls class="image-preview"><source src="${fileUrl}" type="${file.type}"></video>`;
                }
                
                if (sender === 'user') {
                    messageDiv.innerHTML = `
                        <div class="bg-purple-500 text-white p-3 rounded-lg shadow-sm max-w-xs sm:max-w-md md:max-w-lg">
                            ${content}
                            <p class="text-xs text-purple-100 mt-2 text-right">${file.name}<br>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white"></i>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs sm:max-w-md md:max-w-lg">
                            ${content}
                            <p class="text-xs text-gray-500 mt-2">${file.name}<br>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                    `;
                }
                
                chatContainer.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // Scroll to bottom of chat
            function scrollToBottom() {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Event listeners (FIXED)
            sendButton.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default form submission behavior
                sendMessage();
            });
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent form submission
                    sendMessage();
                }
            });
            
            fileUpload.addEventListener('change', function(e) {
                filesToUpload = Array.from(e.target.files);
                
                if (filesToUpload.length > 0) {
                    filePreviewContainer.classList.remove('hidden');
                    filePreviewContent.innerHTML = '';
                    
                    filesToUpload.forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                const img = document.createElement('img');
                                img.src = event.target.result;
                                img.className = 'image-preview';
                                filePreviewContent.appendChild(img);
                            };
                            reader.readAsDataURL(file);
                        } else if (file.type.startsWith('video/')) {
                            const fileInfo = document.createElement('div');
                            fileInfo.className = 'flex items-center space-x-2';
                            fileInfo.innerHTML = `
                                <i class="fas fa-video text-purple-500"></i>
                                <span class="text-sm">${file.name}</span>
                            `;
                            filePreviewContent.appendChild(fileInfo);
                        }
                    });
                }
            });
            
            clearFiles.addEventListener('click', function() {
                filesToUpload = [];
                fileUpload.value = '';
                filePreviewContainer.classList.add('hidden');
                filePreviewContent.innerHTML = '';
            });
        });
    </script>
</body>
</html>
